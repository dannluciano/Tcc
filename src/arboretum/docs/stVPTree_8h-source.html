<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>stVPTree.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<h1>GBDI Arboretum<br><small>Version Release 1</small></h1>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>stVPTree.h</h1><a href="stVPTree_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/**********************************************************************</span>
00002 <span class="comment">* GBDI Arboretum - Copyright (c) 2002-2004 GBDI-ICMC-USP</span>
00003 <span class="comment">*</span>
00004 <span class="comment">*                           Homepage: http://gbdi.icmc.usp.br/arboretum</span>
00005 <span class="comment">**********************************************************************/</span>
00006 <span class="comment">/* ====================================================================</span>
00007 <span class="comment"> * The GBDI-ICMC-USP Software License Version 1.0</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Copyright (c) 2004 Grupo de Bases de Dados e Imagens, Instituto de</span>
00010 <span class="comment"> * Ciências Matemáticas e de Computação, University of São Paulo -</span>
00011 <span class="comment"> * Brazil (the Databases and Image Group - Intitute of Matematical and </span>
00012 <span class="comment"> * Computer Sciences).  All rights reserved.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, are permitted provided that the following conditions</span>
00016 <span class="comment"> * are met:</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * 1. Redistributions of source code must retain the above copyright</span>
00019 <span class="comment"> *    notice, this list of conditions and the following disclaimer.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span>
00022 <span class="comment"> *    notice, this list of conditions and the following disclaimer in</span>
00023 <span class="comment"> *    the documentation and/or other materials provided with the</span>
00024 <span class="comment"> *    distribution.</span>
00025 <span class="comment"> *</span>
00026 <span class="comment"> * 3. The end-user documentation included with the redistribution,</span>
00027 <span class="comment"> *    if any, must include the following acknowledgment:</span>
00028 <span class="comment"> *       "This product includes software developed by Grupo de Bases</span>
00029 <span class="comment"> *        de Dados e Imagens, Instituto de Ciências Matemáticas e de</span>
00030 <span class="comment"> *        Computação, University of São Paulo - Brazil (the Databases </span>
00031 <span class="comment"> *        and Image Group - Intitute of Matematical and Computer </span>
00032 <span class="comment"> *        Sciences)"</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</span>
00035 <span class="comment"> *    if and wherever such third-party acknowledgments normally appear.</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> * 4. The names of the research group, institute, university, authors</span>
00038 <span class="comment"> *    and collaborators must not be used to endorse or promote products</span>
00039 <span class="comment"> *    derived from this software without prior written permission.</span>
00040 <span class="comment"> *</span>
00041 <span class="comment"> * 5. The names of products derived from this software may not contain</span>
00042 <span class="comment"> *    the name of research group, institute or university, without prior</span>
00043 <span class="comment"> *    written permission of the authors of this software.</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span>
00046 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
00047 <span class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
00048 <span class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THE AUTHORS OF THIS SOFTWARE OR</span>
00049 <span class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00050 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00051 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
00052 <span class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
00053 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
00054 <span class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
00055 <span class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00056 <span class="comment"> * SUCH DAMAGE.</span>
00057 <span class="comment"> *</span>
00058 <span class="comment"> * ====================================================================</span>
00059 <span class="comment"> *                                            http://gbdi.icmc.usp.br/</span>
00060 <span class="comment"> */</span>
00061 
00072 <span class="comment">// Copyright (c) 2004 GBDI-ICMC-USP</span>
00073 
00074 
00075 <span class="preprocessor">#ifndef __STVPTREE_H</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define __STVPTREE_H</span>
00077 <span class="preprocessor"></span>
00078 <span class="preprocessor">#include &lt;math.h&gt;</span>
00079 <span class="preprocessor">#include &lt;<a class="code" href="stCommon_8h.html">arboretum/stCommon.h</a>&gt;</span>
00080 <span class="preprocessor">#include &lt;<a class="code" href="stMetricTree_8h.html">arboretum/stMetricTree.h</a>&gt;</span>
00081 <span class="preprocessor">#include &lt;<a class="code" href="stVPNode_8h.html">arboretum/stVPNode.h</a>&gt;</span>
00082 
00102 <span class="keyword">template</span> &lt;<span class="keyword">class</span> ObjectType, <span class="keyword">class</span> EvaluatorType&gt;
<a name="l00103"></a><a class="code" href="classstVPTree.html">00103</a> <span class="keyword">class </span><a class="code" href="classstVPTree.html">stVPTree</a>: <span class="keyword">public</span> <a class="code" href="classstMetricTree.html">stMetricTree</a>&lt;ObjectType, EvaluatorType&gt;{
00104 
00105    <span class="keyword">public</span>:
00106 
<a name="l00110"></a><a class="code" href="structstVPTree_1_1VPTreeHeader.html">00110</a>       <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstVPTree_1_1VPTreeHeader.html">VPTreeHeader</a>{
<a name="l00116"></a><a class="code" href="structstVPTree_1_1VPTreeHeader.html#o0">00116</a>          <span class="keywordtype">char</span> <a class="code" href="structstVPTree_1_1VPTreeHeader.html#o0">Magic</a>[4];
00117       
<a name="l00121"></a><a class="code" href="structstVPTree_1_1VPTreeHeader.html#o1">00121</a>          <a class="code" href="group__types.html#a4">stPageID</a> <a class="code" href="structstVPTree_1_1VPTreeHeader.html#o1">Root</a>;
00122 
<a name="l00126"></a><a class="code" href="structstVPTree_1_1VPTreeHeader.html#o2">00126</a>          <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="structstVPTree_1_1VPTreeHeader.html#o2">Height</a>;
00127 
<a name="l00131"></a><a class="code" href="structstVPTree_1_1VPTreeHeader.html#o3">00131</a>          <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="structstVPTree_1_1VPTreeHeader.html#o3">ObjectCount</a>;
00132 
<a name="l00136"></a><a class="code" href="structstVPTree_1_1VPTreeHeader.html#o4">00136</a>          <a class="code" href="group__types.html#a5">stSize</a> <a class="code" href="structstVPTree_1_1VPTreeHeader.html#o4">NodeCount</a>;
00137       } <a class="code" href="structstVPTree_1_1VPTreeHeader.html">stVPTreeHeader</a>;
00138 
<a name="l00142"></a><a class="code" href="classstVPTree.html#w1">00142</a>       <span class="keyword">typedef</span> ObjectType <a class="code" href="classstVPTree.html#w1">tObject</a>;
00143 
<a name="l00147"></a><a class="code" href="classstVPTree.html#w2">00147</a>       <span class="keyword">typedef</span> EvaluatorType <a class="code" href="classstVPTree.html#w2">tMetricEvaluator</a>;
00148 
<a name="l00152"></a><a class="code" href="classstVPTree.html#w3">00152</a>       <span class="keyword">typedef</span> stResult &lt;ObjectType&gt; <a class="code" href="classstResult.html">tResult</a>;
00153 
00159       <a class="code" href="classstVPTree.html#a0">stVPTree</a>(<a class="code" href="classstPageManager.html">stPageManager</a> * pageman);
00160 
00164       <span class="keyword">virtual</span> <a class="code" href="classstVPTree.html#a1">~stVPTree</a>();
00165 
00173       <span class="keywordtype">bool</span> <a class="code" href="classstVPTree.html#a2">Add</a>(<a class="code" href="classstVPTree.html#w1">tObject</a> ** objects, <span class="keywordtype">long</span> listSize);
00174 
00181       <span class="keywordtype">bool</span> <a class="code" href="classstVPTree.html#a2">Add</a>(<a class="code" href="classstVPTree.html#w1">tObject</a> * obj);
00182 
00188       <span class="keywordtype">bool</span> <a class="code" href="classstVPTree.html#a4">MakeVPTree</a>();
00189 
00190 <span class="preprocessor">      #ifdef __stDEBUG__</span>
00191 <span class="preprocessor"></span>
00197          <a class="code" href="group__types.html#a4">stPageID</a> GetRoot(){
00198             <span class="keywordflow">return</span> this-&gt;Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o1">Root</a>;
00199          }<span class="comment">//end GetRoot</span>
00200 <span class="preprocessor">      #endif //__stDEBUG__</span>
00201 <span class="preprocessor"></span>
<a name="l00205"></a><a class="code" href="classstVPTree.html#a5">00205</a>       <span class="keyword">virtual</span> <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="classstVPTree.html#a5">GetHeight</a>(){
00206          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o2">Height</a>;
00207       }<span class="comment">//end GetHeight</span>
00208 
<a name="l00212"></a><a class="code" href="classstVPTree.html#a6">00212</a>       <span class="keyword">virtual</span> <span class="keywordtype">long</span> <a class="code" href="classstVPTree.html#a6">GetNumberOfObjects</a>(){
00213          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o3">ObjectCount</a>;
00214       }<span class="comment">//end GetNumberOfObjects</span>
00215 
00225       <a class="code" href="classstVPTree.html#w3">tResult</a> * <a class="code" href="classstVPTree.html#a7">RangeQuery</a>(tObject * sample, <a class="code" href="group__types.html#a6">stDistance</a> range);
00226 
00236       <a class="code" href="classstVPTree.html#w3">tResult</a> * <a class="code" href="classstVPTree.html#a8">NearestQuery</a>(tObject * sample, <a class="code" href="group__types.html#a7">stCount</a> k, <span class="keywordtype">bool</span> tie = <span class="keyword">false</span>);
00237 
00238    <span class="keyword">private</span>:
00239 
00244       <a class="code" href="classstPage.html">stPage</a> * HeaderPage;
00245 
00249       <a class="code" href="classstVPTree.html#w0">stVPTreeHeader</a> * Header;
00250 
00254       <span class="keywordtype">bool</span> HeaderUpdate;
00255 
00259       <a class="code" href="classstVPTree.html#w1">tObject</a> ** Objects;
00260 
00264       <span class="keywordtype">long</span> Size;
00265 
00269       <span class="keywordtype">long</span> Capacity;
00270 
00274       <span class="keywordtype">long</span> Increment;
00275 
00276 <span class="preprocessor">      #ifndef __stDEBUG__</span>
00277 <span class="preprocessor"></span>
00280          <a class="code" href="group__types.html#a4">stPageID</a> GetRoot(){
00281             <span class="keywordflow">return</span> this-&gt;Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o1">Root</a>;
00282          }<span class="comment">//end GetRoot</span>
00283 <span class="preprocessor">      #endif // __stDEBUG__</span>
00284 <span class="preprocessor"></span>
00288       <span class="keywordtype">void</span> SetRoot(<a class="code" href="group__types.html#a4">stPageID</a> root){
00289          Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o1">Root</a> = root;
00290          HeaderUpdate = <span class="keyword">true</span>;
00291       }<span class="comment">//end SetRoot</span>
00292 
00296       <span class="keywordtype">void</span> LoadHeader();
00297 
00303       <span class="keywordtype">void</span> DefaultHeader();
00304 
00308       <span class="keywordtype">void</span> WriteHeader(){
00309          <span class="keywordflow">if</span> (HeaderUpdate){
00310             <a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a2">WriteHeaderPage</a>(HeaderPage);
00311             HeaderUpdate = <span class="keyword">false</span>;
00312          }<span class="comment">//end if</span>
00313       }<span class="comment">//end WriteHeader</span>
00314 
00321       <span class="keywordtype">void</span> FlushHeader(){
00322          <span class="keywordflow">if</span> (HeaderPage != NULL){
00323             <span class="keywordflow">if</span> (Header != NULL){
00324                WriteHeader();
00325             }<span class="comment">//end if</span>
00326             <a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a5">ReleasePage</a>(HeaderPage);
00327          }<span class="comment">//end if</span>
00328       }<span class="comment">//end FlushHeader</span>
00329       
00333       <a class="code" href="classstPage.html">stPage</a> * NewPage(){
00334          Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o4">NodeCount</a>++;
00335          <span class="keywordflow">return</span> this-&gt;<a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a6">GetNewPage</a>();
00336          HeaderUpdate = <span class="keyword">true</span>;
00337       }<span class="comment">//end NewPage</span>
00338 
00342       <span class="keywordtype">void</span> DisposePage(<a class="code" href="classstPage.html">stPage</a> * page){
00343          Header-&gt;<a class="code" href="structstVPTree_1_1VPTreeHeader.html#o4">NodeCount</a>--;
00344          this-&gt;<a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a8">DisposePage</a>(page);
00345          HeaderUpdate = <span class="keyword">true</span>;
00346       }<span class="comment">//end DisposePage</span>
00347 
00353       <a class="code" href="group__types.html#a4">stPageID</a> <a class="code" href="classstVPTree.html#a4">MakeVPTree</a>(tObject ** objects, <a class="code" href="structstDistanceIndex.html">stDistanceIndex</a> * &amp; selected,
00354                           <span class="keywordtype">long</span> size);
00355 
00360       <span class="keywordtype">long</span> SelectVP(tObject ** objects, <a class="code" href="structstDistanceIndex.html">stDistanceIndex</a> * selected, <span class="keywordtype">long</span> size);
00361 
00366       <span class="keywordtype">long</span> GetMedian(tObject ** objects, <a class="code" href="structstDistanceIndex.html">stDistanceIndex</a> * sample, <span class="keywordtype">long</span> sampleSize,
00367                     <span class="keywordtype">long</span> vantage);
00368 
00372       <a class="code" href="group__types.html#a6">stDistance</a> GetSecondMoment(<a class="code" href="structstDistanceIndex.html">stDistanceIndex</a> * sample, <span class="keywordtype">long</span> sampleSize, <span class="keywordtype">long</span> median);
00373 
00377       <span class="keywordtype">long</span> PickSampleSize(<span class="keywordtype">long</span> size){
00378          <span class="keywordtype">long</span> sampleSize;
00379 
00380          <span class="comment">// Try to get 10%</span>
00381          sampleSize = (<span class="keywordtype">long</span>) ceil(0.09 * (<span class="keywordtype">double</span> )size);
00382          <span class="keywordflow">if</span> (sampleSize &lt; 50){
00383             sampleSize = 50;
00384             <span class="keywordflow">if</span> (size &lt; sampleSize){
00385                sampleSize = size;
00386             }<span class="comment">//end if</span>
00387          }<span class="comment">//end if</span>
00388          <span class="keywordflow">if</span> (sampleSize &gt; 500){
00389             sampleSize = 500;
00390             <span class="keywordflow">if</span> (size &lt; sampleSize){
00391                sampleSize = size;
00392             }<span class="comment">//end if</span>
00393          }<span class="comment">//end if</span>
00394          <span class="keywordflow">return</span> sampleSize;
00395       }<span class="comment">//end PickSampleSize</span>
00396 
00400       <span class="keywordtype">void</span> MakeSample(<a class="code" href="structstDistanceIndex.html">stDistanceIndex</a> * sample, <span class="keywordtype">long</span> sampleSize,
00401                       <a class="code" href="structstDistanceIndex.html">stDistanceIndex</a> * selected, <span class="keywordtype">long</span> size);
00402 
00407       <span class="keywordtype">void</span> Resize();
00408       
00416       <span class="keywordtype">void</span> <a class="code" href="classstVPTree.html#a7">RangeQuery</a>(tObject * sample, <a class="code" href="group__types.html#a6">stDistance</a> range,
00417                       tResult * result, <a class="code" href="group__types.html#a4">stPageID</a> page);
00418 
00426       <span class="keywordtype">void</span> <a class="code" href="classstVPTree.html#a8">NearestQuery</a>(tObject * sample, <a class="code" href="group__types.html#a7">stCount</a> k, tResult * result,
00427                         <a class="code" href="group__types.html#a4">stPageID</a> page);
00428 
00429 };<span class="comment">//end stVPTree</span>
00430 
00431 <span class="preprocessor">#include &lt;arboretum/stVPTree.cc&gt;</span>
00432 
00433 <span class="preprocessor">#endif //__STVPTREE_H</span>
00434 <span class="preprocessor"></span>
</pre></div><hr><address style="align: right;"><small>
Generated on Mon Mar 21 16:12:06 2005 for GBDI Arboretum by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.3.4</small><br>
Copyright &copy 2002-2003 GBDI-ICMC-USP
</address>
</body>
</html>
