<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>stMTree.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<h1>GBDI Arboretum<br><small>Version Release 1</small></h1>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>stMTree.h</h1><a href="stMTree_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/**********************************************************************</span>
00002 <span class="comment">* GBDI Arboretum - Copyright (c) 2002-2004 GBDI-ICMC-USP</span>
00003 <span class="comment">*</span>
00004 <span class="comment">*                           Homepage: http://gbdi.icmc.usp.br/arboretum</span>
00005 <span class="comment">**********************************************************************/</span>
00006 <span class="comment">/* ====================================================================</span>
00007 <span class="comment"> * The GBDI-ICMC-USP Software License Version 1.0</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Copyright (c) 2004 Grupo de Bases de Dados e Imagens, Instituto de</span>
00010 <span class="comment"> * Ciências Matemáticas e de Computação, University of São Paulo -</span>
00011 <span class="comment"> * Brazil (the Databases and Image Group - Intitute of Matematical and </span>
00012 <span class="comment"> * Computer Sciences).  All rights reserved.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, are permitted provided that the following conditions</span>
00016 <span class="comment"> * are met:</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * 1. Redistributions of source code must retain the above copyright</span>
00019 <span class="comment"> *    notice, this list of conditions and the following disclaimer.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span>
00022 <span class="comment"> *    notice, this list of conditions and the following disclaimer in</span>
00023 <span class="comment"> *    the documentation and/or other materials provided with the</span>
00024 <span class="comment"> *    distribution.</span>
00025 <span class="comment"> *</span>
00026 <span class="comment"> * 3. The end-user documentation included with the redistribution,</span>
00027 <span class="comment"> *    if any, must include the following acknowledgment:</span>
00028 <span class="comment"> *       "This product includes software developed by Grupo de Bases</span>
00029 <span class="comment"> *        de Dados e Imagens, Instituto de Ciências Matemáticas e de</span>
00030 <span class="comment"> *        Computação, University of São Paulo - Brazil (the Databases </span>
00031 <span class="comment"> *        and Image Group - Intitute of Matematical and Computer </span>
00032 <span class="comment"> *        Sciences)"</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</span>
00035 <span class="comment"> *    if and wherever such third-party acknowledgments normally appear.</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> * 4. The names of the research group, institute, university, authors</span>
00038 <span class="comment"> *    and collaborators must not be used to endorse or promote products</span>
00039 <span class="comment"> *    derived from this software without prior written permission.</span>
00040 <span class="comment"> *</span>
00041 <span class="comment"> * 5. The names of products derived from this software may not contain</span>
00042 <span class="comment"> *    the name of research group, institute or university, without prior</span>
00043 <span class="comment"> *    written permission of the authors of this software.</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span>
00046 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
00047 <span class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
00048 <span class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THE AUTHORS OF THIS SOFTWARE OR</span>
00049 <span class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00050 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00051 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
00052 <span class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
00053 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
00054 <span class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
00055 <span class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00056 <span class="comment"> * SUCH DAMAGE.</span>
00057 <span class="comment"> *</span>
00058 <span class="comment"> * ====================================================================</span>
00059 <span class="comment"> *                                            http://gbdi.icmc.usp.br/</span>
00060 <span class="comment"> */</span>
00072 <span class="comment">// Copyright (c) 2004 GBDI-ICMC-USP</span>
00073 
00074 <span class="preprocessor">#ifndef __STMTREE_H</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#define __STMTREE_H</span>
00076 <span class="preprocessor"></span>
00077 <span class="preprocessor">#include &lt;<a class="code" href="stUtil_8h.html">arboretum/stUtil.h</a>&gt;</span>
00078 <span class="preprocessor">#include &lt;<a class="code" href="stTypes_8h.html">arboretum/stTypes.h</a>&gt;</span>
00079 <span class="preprocessor">#include &lt;<a class="code" href="stMetricTree_8h.html">arboretum/stMetricTree.h</a>&gt;</span>
00080 <span class="preprocessor">#include &lt;<a class="code" href="stMNode_8h.html">arboretum/stMNode.h</a>&gt;</span>
00081 <span class="preprocessor">#include &lt;<a class="code" href="stPageManager_8h.html">arboretum/stPageManager.h</a>&gt;</span>
00082 <span class="preprocessor">#include &lt;<a class="code" href="stGenericPriorityQueue_8h.html">arboretum/stGenericPriorityQueue.h</a>&gt;</span>
00083 
00084 <span class="comment">// this is used to set the initial size of the dynamic queue</span>
<a name="l00085"></a><a class="code" href="stMTree_8h.html#a0">00085</a> <span class="preprocessor">#define STARTVALUEQUEUE 200</span>
00086 <span class="preprocessor"></span><span class="comment">// this is used to set the increment size of the dynamic queue</span>
<a name="l00087"></a><a class="code" href="stMTree_8h.html#a1">00087</a> <span class="preprocessor">#define INCREMENTVALUEQUEUE 200</span>
00088 <span class="preprocessor"></span>
00089 <span class="preprocessor">#include &lt;string.h&gt;</span>
00090 <span class="preprocessor">#include &lt;math.h&gt;</span>
00091 <span class="preprocessor">#include &lt;values.h&gt;</span>
00092 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00093 
00094 
00095 <span class="comment">//=============================================================================</span>
00096 <span class="comment">// Class template stMLogicNode</span>
00097 <span class="comment">//-----------------------------------------------------------------------------</span>
00116 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> ObjectType, <span class="keyword">class</span> EvaluatorType&gt;
<a name="l00117"></a><a class="code" href="classstMLogicNode.html">00117</a> <span class="keyword">class </span><a class="code" href="classstMLogicNode.html">stMLogicNode</a>{
00118    <span class="keyword">public</span>:
00124       <a class="code" href="classstMLogicNode.html#a0">stMLogicNode</a>(<span class="keywordtype">int</span> maxOccupation);
00125 
00131       <a class="code" href="classstMLogicNode.html#a1">~stMLogicNode</a>();
00132 
<a name="l00142"></a><a class="code" href="classstMLogicNode.html#a2">00142</a>       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a2">AddEntry</a>(ObjectType * obj){
00143 
00144          Entries[Count].Object = obj;
00145          Entries[Count].Mine = <span class="keyword">true</span>;
00146          Count ++;
00147          <span class="keywordflow">return</span> Count - 1;
00148       }<span class="comment">//end AddEntry</span>
00149 
00159       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a2">AddEntry</a>(<a class="code" href="group__types.html#a5">stSize</a> size, <span class="keyword">const</span> <a class="code" href="group__types.html#a3">stByte</a> * object);
00160 
<a name="l00164"></a><a class="code" href="classstMLogicNode.html#a4">00164</a>       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a4">GetNumberOfEntries</a>(){
00165          <span class="keywordflow">return</span> Count;
00166       }<span class="comment">//end GetNumberOfEntries</span>
00167 
<a name="l00173"></a><a class="code" href="classstMLogicNode.html#a5">00173</a>       ObjectType * <a class="code" href="classstMLogicNode.html#a5">GetObject</a>(<span class="keywordtype">int</span> idx){
00174          <span class="keywordflow">return</span> Entries[idx].Object;
00175       }<span class="comment">//end GetObject</span>
00176 
<a name="l00182"></a><a class="code" href="classstMLogicNode.html#a6">00182</a>       ObjectType * <a class="code" href="classstMLogicNode.html#a6">operator []</a>(<span class="keywordtype">int</span> idx){
00183          <span class="keywordflow">return</span> Entries[idx].Object;
00184       }<span class="comment">//end operator []</span>
00185 
<a name="l00191"></a><a class="code" href="classstMLogicNode.html#a7">00191</a>       <a class="code" href="group__types.html#a4">stPageID</a> <a class="code" href="classstMLogicNode.html#a7">GetPageID</a>(<span class="keywordtype">int</span> idx){
00192          <span class="keywordflow">return</span> Entries[idx].PageID;
00193       }<span class="comment">//end GetPageID</span>
00194 
<a name="l00201"></a><a class="code" href="classstMLogicNode.html#a8">00201</a>       <a class="code" href="group__types.html#a6">stDistance</a> <a class="code" href="classstMLogicNode.html#a8">GetRadius</a>(<span class="keywordtype">int</span> idx){
00202          <span class="keywordflow">return</span> Entries[idx].Radius;
00203       }<span class="comment">//end GetRadius</span>
00204 
<a name="l00212"></a><a class="code" href="classstMLogicNode.html#a9">00212</a>       <span class="keywordtype">void</span> <a class="code" href="classstMLogicNode.html#a9">SetEntry</a>(<span class="keywordtype">int</span> idx, <a class="code" href="group__types.html#a4">stPageID</a> pageID, <a class="code" href="group__types.html#a6">stDistance</a> radius){
00213          Entries[idx].PageID = pageID;
00214          Entries[idx].Radius = radius;
00215       }<span class="comment">//end GetPageID</span>
00216 
00223       <span class="keywordtype">void</span> <a class="code" href="classstMLogicNode.html#a10">AddIndexNode</a>(<a class="code" href="classstMIndexNode.html">stMIndexNode</a> * node);
00224 
00231       <span class="keywordtype">void</span> <a class="code" href="classstMLogicNode.html#a11">AddLeafNode</a>(<a class="code" href="classstMLeafNode.html">stMLeafNode</a> * node);
00232 
<a name="l00238"></a><a class="code" href="classstMLogicNode.html#a12">00238</a>       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a12">GetRepresentativeIndex</a>(<span class="keywordtype">int</span> idx){
00239          <span class="keywordflow">return</span> RepIndex[idx];
00240       }<span class="comment">//end GetRepresentativeIndex</span>
00241 
<a name="l00247"></a><a class="code" href="classstMLogicNode.html#a13">00247</a>       ObjectType * <a class="code" href="classstMLogicNode.html#a13">GetRepresentative</a>(<span class="keywordtype">int</span> idx){
00248         <span class="keywordflow">return</span> Entries[RepIndex[idx]].Object;
00249       }<span class="comment">//end GetRepresentative</span>
00250 
<a name="l00258"></a><a class="code" href="classstMLogicNode.html#a14">00258</a>       <span class="keywordtype">void</span> <a class="code" href="classstMLogicNode.html#a14">SetRepresentative</a>(<span class="keywordtype">int</span> rep0, <span class="keywordtype">int</span> rep1){
00259          RepIndex[0] = rep0;
00260          RepIndex[1] = rep1;
00261       }<span class="comment">//end SetRepresentative</span>
00262 
<a name="l00275"></a><a class="code" href="classstMLogicNode.html#a15">00275</a>       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a15">Distribute</a>(<a class="code" href="classstMIndexNode.html">stMIndexNode</a> * node0, ObjectType * &amp; rep0,
00276             <a class="code" href="classstMIndexNode.html">stMIndexNode</a> * node1, ObjectType * &amp; rep1,
00277             EvaluatorType * metricEvaluator){
00278          <span class="keywordtype">int</span> result;
00279 
00280          <span class="comment">// Distribute...</span>
00281          result = <a class="code" href="classstMLogicNode.html#a17">TestDistribution</a>(node0, node1, metricEvaluator);
00282 
00283          <span class="comment">// Representatives</span>
00284          rep0 = <a class="code" href="classstMLogicNode.html#a23">BuyObject</a>(<a class="code" href="classstMLogicNode.html#a12">GetRepresentativeIndex</a>(0));
00285          rep1 = <a class="code" href="classstMLogicNode.html#a23">BuyObject</a>(<a class="code" href="classstMLogicNode.html#a12">GetRepresentativeIndex</a>(1));
00286 
00287          <span class="keywordflow">return</span> result;
00288       }<span class="comment">//end Distribute</span>
00289 
<a name="l00302"></a><a class="code" href="classstMLogicNode.html#a16">00302</a>       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a15">Distribute</a>(<a class="code" href="classstMLeafNode.html">stMLeafNode</a> * node0, ObjectType * &amp; rep0,
00303             <a class="code" href="classstMLeafNode.html">stMLeafNode</a> * node1, ObjectType * &amp; rep1,
00304             EvaluatorType * metricEvaluator){
00305          <span class="keywordtype">int</span> result;
00306 
00307          <span class="comment">// Distribute...</span>
00308          result = <a class="code" href="classstMLogicNode.html#a17">TestDistribution</a>(node0, node1, metricEvaluator);
00309 
00310          <span class="comment">// Representatives</span>
00311          rep0 = <a class="code" href="classstMLogicNode.html#a23">BuyObject</a>(<a class="code" href="classstMLogicNode.html#a12">GetRepresentativeIndex</a>(0));
00312          rep1 = <a class="code" href="classstMLogicNode.html#a23">BuyObject</a>(<a class="code" href="classstMLogicNode.html#a12">GetRepresentativeIndex</a>(1));
00313 
00314          <span class="keywordflow">return</span> result;
00315       }<span class="comment">//end Distribute</span>
00316 
00329       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a17">TestDistribution</a>(<a class="code" href="classstMIndexNode.html">stMIndexNode</a> * node0, <a class="code" href="classstMIndexNode.html">stMIndexNode</a> * node1,
00330             EvaluatorType * metricEvaluator);
00331 
00342       <span class="keywordtype">int</span> <a class="code" href="classstMLogicNode.html#a17">TestDistribution</a>(<a class="code" href="classstMLeafNode.html">stMLeafNode</a> * node0, <a class="code" href="classstMLeafNode.html">stMLeafNode</a> * node1,
00343             EvaluatorType * metricEvaluator);
00344 
<a name="l00349"></a><a class="code" href="classstMLogicNode.html#a19">00349</a>       <span class="keywordtype">void</span> <a class="code" href="classstMLogicNode.html#a19">SetMinOccupation</a>(<span class="keywordtype">int</span> min){
00350          MinOccupation = min;
00351          <span class="comment">// At least the nodes must store 2 objects.</span>
00352          <span class="keywordflow">if</span> ((MinOccupation &gt; (MaxEntries/2)) || (MinOccupation == 0)){
00353             MinOccupation = 2;
00354          }<span class="comment">//end if</span>
00355       }<span class="comment">//end SetMinOccupation</span>
00356 
<a name="l00361"></a><a class="code" href="classstMLogicNode.html#a20">00361</a>       <a class="code" href="group__types.html#a8">stNodeType</a> <a class="code" href="classstMLogicNode.html#a20">GetNodeType</a>(){
00362          <span class="keywordflow">return</span> NodeType;
00363       }<span class="comment">//end GetNodeType</span>
00364 
<a name="l00368"></a><a class="code" href="classstMLogicNode.html#a21">00368</a>       <span class="keywordtype">void</span> <a class="code" href="classstMLogicNode.html#a21">SetNodeType</a>(<a class="code" href="group__types.html#a8">stNodeType</a> type){
00369          NodeType = type;
00370       }<span class="comment">//end SetNodeType</span>
00371 
<a name="l00378"></a><a class="code" href="classstMLogicNode.html#a22">00378</a>       <span class="keywordtype">bool</span> <a class="code" href="classstMLogicNode.html#a22">IsRepresentative</a>(<span class="keywordtype">int</span> idx){
00379          <span class="keywordflow">return</span> ((idx == RepIndex[0]) || (idx == RepIndex[1]));
00380       }<span class="comment">//end IsRepresentative</span>
00381 
<a name="l00393"></a><a class="code" href="classstMLogicNode.html#a23">00393</a>       ObjectType * <a class="code" href="classstMLogicNode.html#a23">BuyObject</a>(<span class="keywordtype">int</span> idx){
00394          Entries[idx].Mine = <span class="keyword">false</span>;
00395          <span class="keywordflow">return</span> Entries[idx].Object;
00396       }<span class="comment">//end BuyObject</span>
00397 
00398    <span class="keyword">private</span>:
00402       <span class="keyword">struct </span>stMLogicEntry{
00406          ObjectType * Object;
00407 
00411          <a class="code" href="group__types.html#a4">stPageID</a> PageID;
00412 
00416          <a class="code" href="group__types.html#a6">stDistance</a> Radius;
00417 
00421          <span class="keywordtype">bool</span> Mine;
00422 
00426          <a class="code" href="group__types.html#a6">stDistance</a> Distance[2];
00427 
00431          <span class="keywordtype">bool</span> Mapped;
00432       };
00433 
00437       <span class="keywordtype">int</span> MinOccupation;
00438 
00442       <span class="keyword">struct </span><a class="code" href="classstMLogicEntry.html">stMLogicEntry</a> * Entries;
00443 
00447       <span class="keywordtype">int</span> MaxEntries;
00448 
00452       <span class="keywordtype">int</span> Count;
00453 
00457       <span class="keywordtype">int</span> RepIndex[2];
00458 
00462       <span class="keywordtype">int</span> NodeType;
00463 
00470       <span class="keywordtype">int</span> UpdateDistances(EvaluatorType * metricEvaluator);
00471 };<span class="comment">//end stMLogicNode</span>
00472 
00473 
00474 
00475 <span class="comment">//=============================================================================</span>
00476 <span class="comment">// Class template stMTree</span>
00477 <span class="comment">//-----------------------------------------------------------------------------</span>
00493 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> ObjectType, <span class="keyword">class</span> EvaluatorType&gt;
<a name="l00494"></a><a class="code" href="classstMTree.html">00494</a> <span class="keyword">class </span><a class="code" href="classstMTree.html">stMTree</a>: <span class="keyword">public</span> <a class="code" href="classstMetricTree.html">stMetricTree</a>&lt; ObjectType, EvaluatorType&gt;{
00495    <span class="keyword">public</span>:
00496 
<a name="l00501"></a><a class="code" href="structstMTree_1_1tMHeader.html">00501</a>       <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structstMTree_1_1tMHeader.html">tMHeader</a>{
<a name="l00507"></a><a class="code" href="structstMTree_1_1tMHeader.html#o0">00507</a>          <span class="keywordtype">char</span> <a class="code" href="structstMTree_1_1tMHeader.html#o0">Magic</a>[4];
00508       
<a name="l00512"></a><a class="code" href="structstMTree_1_1tMHeader.html#o1">00512</a>          <span class="keywordtype">int</span> <a class="code" href="structstMTree_1_1tMHeader.html#o1">SplitMethod</a>;
00513 
<a name="l00517"></a><a class="code" href="structstMTree_1_1tMHeader.html#o2">00517</a>          <span class="keywordtype">int</span> <a class="code" href="structstMTree_1_1tMHeader.html#o2">ChooseSplitStrategyMethod</a>;
00518 
<a name="l00522"></a><a class="code" href="structstMTree_1_1tMHeader.html#o3">00522</a>          <span class="keywordtype">int</span> <a class="code" href="structstMTree_1_1tMHeader.html#o3">ChooseMethod</a>;
00523       
<a name="l00527"></a><a class="code" href="structstMTree_1_1tMHeader.html#o4">00527</a>          <a class="code" href="group__types.html#a4">stPageID</a> <a class="code" href="structstMTree_1_1tMHeader.html#o4">Root</a>;
00528       
<a name="l00532"></a><a class="code" href="structstMTree_1_1tMHeader.html#o5">00532</a>          <span class="keywordtype">double</span> <a class="code" href="structstMTree_1_1tMHeader.html#o5">MinOccupation</a>;
00533 
<a name="l00537"></a><a class="code" href="structstMTree_1_1tMHeader.html#o6">00537</a>          <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="structstMTree_1_1tMHeader.html#o6">MaxOccupation</a>;
00538 
<a name="l00542"></a><a class="code" href="structstMTree_1_1tMHeader.html#o7">00542</a>          <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="structstMTree_1_1tMHeader.html#o7">Height</a>;
00543       
<a name="l00547"></a><a class="code" href="structstMTree_1_1tMHeader.html#o8">00547</a>          <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="structstMTree_1_1tMHeader.html#o8">ObjectCount</a>;
00548          
<a name="l00552"></a><a class="code" href="structstMTree_1_1tMHeader.html#o9">00552</a>          <a class="code" href="group__types.html#a5">stSize</a> <a class="code" href="structstMTree_1_1tMHeader.html#o9">NodeCount</a>;
00553       }<a class="code" href="structstMTree_1_1tMHeader.html">stMHeader</a>;   
00554 
<a name="l00558"></a><a class="code" href="classstMTree.html#w24">00558</a>       <span class="keyword">enum</span> <a class="code" href="classstMTree.html#w24">tTBFunction</a>{
00559 
00563          <a class="code" href="classstMTree.html#w24w5">MIN_R_INCR</a>,
00564 
00568          <a class="code" href="classstMTree.html#w24w6">MIN_OVERLAP</a>,
00569          
00573          <a class="code" href="classstMTree.html#w24w7">MIXED</a>
00574       };<span class="comment">//end tTBFunction;</span>
00575 
<a name="l00580"></a><a class="code" href="classstMTree.html#w25">00580</a>       <span class="keyword">enum</span> <a class="code" href="classstMTree.html#w25">tPPFunction</a>{
00584          <a class="code" href="classstMTree.html#w25w8">RANDOM</a>,
00585 
00590          <a class="code" href="classstMTree.html#w25w9">CONFIRMED</a>,
00591 
00597          <a class="code" href="classstMTree.html#w25w10">MAX_UB_DIST</a>,
00598 
00602          <a class="code" href="classstMTree.html#w25w11">MIN_RAD</a>,
00603 
00607          <a class="code" href="classstMTree.html#w25w12">MIN_OVERLAPS</a>,
00608 
00613          <a class="code" href="classstMTree.html#w25w13">SAMPLING</a>,
00614       };<span class="comment">//end tPPFunction;</span>
00615 
<a name="l00621"></a><a class="code" href="classstMTree.html#w26">00621</a>       <span class="keyword">enum</span> <a class="code" href="classstMTree.html#w26">tPVFunction</a>{
00622 
00626          <a class="code" href="classstMTree.html#w26w14">RANDOMV</a>,
00627 
00632          <a class="code" href="classstMTree.html#w26w15">SAMPLINGV</a>,
00633 
00638          <a class="code" href="classstMTree.html#w26w16">MAX_LB_DIST</a>,
00639 
00644          <a class="code" href="classstMTree.html#w26w17">mM_RAD</a>
00645       };<span class="comment">//end tPVFunction;</span>
00646 
<a name="l00650"></a><a class="code" href="classstMTree.html#w27">00650</a>       <span class="keyword">enum</span> <a class="code" href="classstMTree.html#w27">tRFunction</a>{
00651 
00655          <a class="code" href="classstMTree.html#w27w18">LB</a>,
00656 
00660          <a class="code" href="classstMTree.html#w27w19">AVG</a>,
00661 
00665          <a class="code" href="classstMTree.html#w27w20">UB</a>
00666       };<span class="comment">//end tRFunction;</span>
00667 
<a name="l00681"></a><a class="code" href="classstMTree.html#w28">00681</a>       <span class="keyword">enum</span> <a class="code" href="classstMTree.html#w28">tSFunction</a>{
00682 
00686          <a class="code" href="classstMTree.html#w28w21">G_HYPERPL</a>,
00687 
00691          <a class="code" href="classstMTree.html#w28w22">BAL_G_HYPERPL</a>,
00692 
00696          <a class="code" href="classstMTree.html#w28w23">BALANCED</a>
00697       };<span class="comment">//end tSFunction;</span>
00698 
<a name="l00702"></a><a class="code" href="classstMTree.html#w1">00702</a>       <span class="keyword">typedef</span> stResult &lt;ObjectType&gt; <a class="code" href="classstResult.html">tResult</a>;
00703 
00711       <a class="code" href="classstMTree.html#a0">stMTree</a>(<a class="code" href="classstPageManager.html">stPageManager</a> * pageman);
00712 
00718       <span class="keyword">virtual</span> <a class="code" href="classstMTree.html#a1">~stMTree</a>();
00719 
00725       <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classstMTree.html#a2">Add</a>(ObjectType * newObj);
00726 
<a name="l00730"></a><a class="code" href="classstMTree.html#a3">00730</a>       <span class="keyword">virtual</span> <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="classstMTree.html#a3">GetHeight</a>(){
00731          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o7">Height</a>;
00732       }<span class="comment">//end GetHeight</span>
00733 
<a name="l00737"></a><a class="code" href="classstMTree.html#a4">00737</a>       <span class="keyword">virtual</span> <span class="keywordtype">long</span> <a class="code" href="classstMTree.html#a4">GetNumberOfObjects</a>(){
00738          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o8">ObjectCount</a>;
00739       }<span class="comment">//end GetNumberOfObjects</span>
00740 
<a name="l00744"></a><a class="code" href="classstMTree.html#a5">00744</a>       <span class="keyword">virtual</span> <a class="code" href="group__types.html#a7">stCount</a> <a class="code" href="classstMTree.html#a5">GetMaxOccupation</a>(){
00745          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o6">MaxOccupation</a>;
00746       }<span class="comment">//end GetMaxOccupation</span>
00747 
<a name="l00751"></a><a class="code" href="classstMTree.html#a6">00751</a>       <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a6">SetMaxOccupation</a>(<a class="code" href="group__types.html#a7">stCount</a> newValue){
00752          <span class="keywordflow">if</span> (newValue &gt; Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o6">MaxOccupation</a>){
00753             Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o6">MaxOccupation</a> = newValue;
00754          }<span class="comment">//end if</span>
00755       }<span class="comment">//end SetMaxOccupation</span>
00756 
<a name="l00760"></a><a class="code" href="classstMTree.html#a7">00760</a>       <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="classstMTree.html#a7">GetMinOccupation</a>(){
00761          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o5">MinOccupation</a>;
00762       }<span class="comment">//end GetMinOccupation</span>
00763 
<a name="l00767"></a><a class="code" href="classstMTree.html#a8">00767</a>       <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a8">SetMinOccupation</a>(<span class="keywordtype">double</span> min){
00768          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o5">MinOccupation</a> = min;
00769       }<span class="comment">//end SetMinOccupation</span>
00770 
<a name="l00774"></a><a class="code" href="classstMTree.html#a9">00774</a>       <span class="keyword">virtual</span> <span class="keywordtype">long</span> <a class="code" href="classstMTree.html#a9">GetNodeCount</a>(){
00775          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o9">NodeCount</a>;
00776       }<span class="comment">//end GetNodeCount</span>
00777 
00786       <a class="code" href="group__types.html#a6">stDistance</a> <a class="code" href="classstMTree.html#a10">GetDistanceLimit</a>();
00787 
00788       <span class="comment">// Tree Configuration</span>
<a name="l00795"></a><a class="code" href="classstMTree.html#a11">00795</a> <span class="comment"></span>      <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a11">SetSplitMethod</a>(<span class="keyword">enum</span> tPPFunction method){
00796          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o1">SplitMethod</a> = method;
00797          this-&gt;HeaderUpdate = <span class="keyword">true</span>;
00798       }<span class="comment">//end SetSplitMethod</span>
00799 
<a name="l00803"></a><a class="code" href="classstMTree.html#a12">00803</a>       <span class="keywordtype">int</span> <a class="code" href="classstMTree.html#a12">GetSplitMethod</a>(){
00804          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o1">SplitMethod</a>;
00805       }<span class="comment">//end GetSplitMethod</span>
00806 
<a name="l00813"></a><a class="code" href="classstMTree.html#a13">00813</a>       <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a13">SetChooseMethod</a>(<span class="keyword">enum</span> tTBFunction method){
00814          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o3">ChooseMethod</a> = method;
00815          this-&gt;HeaderUpdate = <span class="keyword">true</span>;
00816       }<span class="comment">//end SetChooseMethod</span>
00817 
<a name="l00821"></a><a class="code" href="classstMTree.html#a14">00821</a>       <span class="keywordtype">int</span> <a class="code" href="classstMTree.html#a14">GetSplitStrategyMethod</a>(){
00822          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o2">ChooseSplitStrategyMethod</a>;
00823       }<span class="comment">//end GetSplitStrategyMethod</span>
00824 
<a name="l00831"></a><a class="code" href="classstMTree.html#a15">00831</a>       <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a15">SetSplitStrategyMethod</a>(<span class="keyword">enum</span> tSFunction method){
00832          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o2">ChooseSplitStrategyMethod</a> = method;
00833          this-&gt;HeaderUpdate = <span class="keyword">true</span>;
00834       }<span class="comment">//end SetSplitStrategyMethod</span>
00835 
<a name="l00839"></a><a class="code" href="classstMTree.html#a16">00839</a>       <span class="keywordtype">int</span> <a class="code" href="classstMTree.html#a16">GetChooseMethod</a>(){
00840          <span class="keywordflow">return</span> Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o3">ChooseMethod</a>;
00841       }<span class="comment">//end GetChooseMethod</span>
00842 
00843 <span class="preprocessor">      #ifdef __stDEBUG__</span>
00844 <span class="preprocessor"></span>
00850       <a class="code" href="group__types.html#a4">stPageID</a> GetRoot(){
00851          <span class="keywordflow">return</span> this-&gt;Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o4">Root</a>;
00852       }<span class="comment">//end GetRoot</span>
00853 <span class="preprocessor">      #endif //__stDEBUG__</span>
00854 <span class="preprocessor"></span>
<a name="l00862"></a><a class="code" href="classstMTree.html#a17">00862</a>       <a class="code" href="group__types.html#a5">stSize</a> <a class="code" href="classstMTree.html#a17">GetUserDataSize</a>(){
00863          <span class="keywordflow">return</span> 0;
00864       }<span class="comment">//end GetUserDataSize</span>
00865 
<a name="l00882"></a><a class="code" href="classstMTree.html#a18">00882</a>       <span class="keywordtype">bool</span> <a class="code" href="classstMTree.html#a18">WriteUserData</a>(<span class="keyword">const</span> <a class="code" href="group__types.html#a3">stByte</a> * userData, <a class="code" href="group__types.html#a5">stSize</a> size){
00883          <span class="keywordflow">return</span> <span class="keyword">false</span>;
00884       }<span class="comment">//end WriteUserData</span>
00885 
<a name="l00902"></a><a class="code" href="classstMTree.html#a19">00902</a>       <span class="keywordtype">bool</span> <a class="code" href="classstMTree.html#a19">ReadUserData</a>(<a class="code" href="group__types.html#a3">stByte</a> * userData, <a class="code" href="group__types.html#a5">stSize</a> size){
00903          <span class="keywordflow">return</span> <span class="keyword">false</span>;
00904       }<span class="comment">//end ReadUserData</span>
00905 
00916       <a class="code" href="classstMTree.html#w1">tResult</a> * <a class="code" href="classstMTree.html#a20">RangeQuery</a>(ObjectType * sample, <a class="code" href="group__types.html#a6">stDistance</a> range);
00917 
00934       <a class="code" href="classstMTree.html#w1">tResult</a> * <a class="code" href="classstMTree.html#a21">NearestQuery</a>(ObjectType * sample, <a class="code" href="group__types.html#a7">stCount</a> k, <span class="keywordtype">bool</span> tie = <span class="keyword">false</span>);
00935 
00952       <a class="code" href="classstMTree.html#w1">tResult</a> * <a class="code" href="classstMTree.html#a22">PointQuery</a>(ObjectType * sample);
00953 
<a name="l00957"></a><a class="code" href="classstMTree.html#w2">00957</a>       <span class="keyword">typedef</span> stGenericPriorityQueue &lt; ObjectType &gt; <a class="code" href="classstGenericPriorityQueue.html">tGenericPriorityQueue</a>;
00958 
<a name="l00962"></a><a class="code" href="classstMTree.html#w3">00962</a>       <span class="keyword">typedef</span> stGenericEntry &lt; ObjectType &gt; <a class="code" href="classstGenericEntry.html">tGenericEntry</a>;
00963 
<a name="l00967"></a><a class="code" href="classstMTree.html#w4">00967</a>       <span class="keyword">typedef</span> stGenericPriorityHeap &lt; ObjectType &gt; <a class="code" href="classstGenericPriorityHeap.html">tPGenericHeap</a>;
00968 
00972       <span class="keyword">virtual</span> <a class="code" href="classstTreeInfoResult.html">stTreeInfoResult</a> * <a class="code" href="classstMTree.html#a23">GetTreeInfo</a>();
00973 
00974    <span class="keyword">private</span>:
00975 
00979       <span class="keyword">typedef</span> stMLogicNode &lt; ObjectType, EvaluatorType &gt; <a class="code" href="classstMLogicNode.html">tLogicNode</a>;
00980 
00984       <span class="keyword">typedef</span> stRPriorityQueue &lt; stDistance, stCount &gt; <a class="code" href="classstRPriorityQueue.html">tPriorityQueue</a>;
00985 
00989       <span class="keyword">typedef</span> stDynamicRPriorityQueue &lt; stDistance, stQueryPriorityQueueValue &gt; <a class="code" href="classstDynamicRPriorityQueue.html">tDynamicPriorityQueue</a>;
00990 
00995       <span class="keyword">enum</span> stInsertAction{
00999          NO_ACT,
01000 
01004          CHANGE_REP,
01005 
01009          PROMOTION
01010       };<span class="comment">//end stInsertAction</span>
01011 
01016       <span class="keyword">struct </span><a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a>{
01020          ObjectType * Rep;
01021 
01025          <a class="code" href="group__types.html#a6">stDistance</a> Radius;
01026 
01030          <a class="code" href="group__types.html#a4">stPageID</a> RootID;
01031       };
01032 
01036       <span class="keywordtype">bool</span> HeaderUpdate;
01037 
01041       <a class="code" href="classstMTree.html#w0">stMHeader</a> * Header;
01042 
01047       <a class="code" href="classstPage.html">stPage</a> * HeaderPage;
01048 
01054       <span class="keywordtype">void</span> DefaultHeader();
01055 
01062       <span class="keywordtype">void</span> LoadHeader();
01063 
01067       <span class="keywordtype">void</span> WriteHeader(){
01068          <span class="comment">// Test if the header was modified.</span>
01069          <span class="keywordflow">if</span> (this-&gt;HeaderUpdate){
01070             <span class="comment">// Yes, write it!</span>
01071             <a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a2">WriteHeaderPage</a>(HeaderPage);
01072             this-&gt;HeaderUpdate = <span class="keyword">false</span>;
01073          }<span class="comment">//end if</span>
01074       }<span class="comment">//end WriteHeader</span>
01075 
01082       <span class="keywordtype">void</span> FlushHeader();
01083       
01087       <a class="code" href="classstPage.html">stPage</a> * NewPage(){
01088          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o9">NodeCount</a>++;
01089          <span class="keywordflow">return</span> this-&gt;<a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a6">GetNewPage</a>();
01090       }<span class="comment">//end NewPage</span>
01091       
01095       <span class="keywordtype">void</span> DisposePage(<a class="code" href="classstPage.html">stPage</a> * page){
01096          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o9">NodeCount</a>--;
01097          this-&gt;<a class="code" href="classstMetricTree.html#p0">myPageManager</a>-&gt;<a class="code" href="classstPageManager.html#a8">DisposePage</a>(page);
01098       }<span class="comment">//end DisposePage</span>
01099 
01108       <span class="keywordtype">int</span> ChooseSubTree(<a class="code" href="classstMIndexNode.html">stMIndexNode</a> * slimIndexNode, ObjectType * obj);
01109 
01117       <span class="keywordtype">void</span> RandomPromote(tLogicNode * node);
01118 
01125       <span class="keywordtype">void</span> MinMaxPromote(tLogicNode * node);
01126 
01137       <span class="keywordtype">void</span> ReDistribute(<a class="code" href="classstMNode.html">stMNode</a> * node, <span class="keywordtype">int</span> &amp; newCenter, <a class="code" href="group__types.html#a6">stDistance</a> &amp; newRadius);
01138 
01144       <span class="keywordtype">bool</span> IsRoot(<a class="code" href="group__types.html#a4">stPageID</a> nodeID){
01145          <span class="keywordflow">return</span> nodeID == this-&gt;Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o4">Root</a>;
01146       }<span class="comment">//end IsRoot</span>
01147 
01148 <span class="preprocessor">      #ifndef __stDEBUG__</span>
01149 <span class="preprocessor"></span>
01152       <a class="code" href="group__types.html#a4">stPageID</a> GetRoot(){
01153          <span class="keywordflow">return</span> this-&gt;Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o4">Root</a>;
01154       }<span class="comment">//end GetRoot</span>
01155 <span class="preprocessor">      #endif // __stDEBUG__</span>
01156 <span class="preprocessor"></span>
01160       <span class="keywordtype">void</span> SetRoot(<a class="code" href="group__types.html#a4">stPageID</a> root){
01161          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o4">Root</a> = root;
01162          this-&gt;HeaderUpdate = <span class="keyword">true</span>;
01163       }<span class="comment">//end SetRoot</span>
01164 
01168       <span class="keywordtype">void</span> UpdateObjectCounter(<span class="keywordtype">int</span> inc){
01169          Header-&gt;<a class="code" href="structstMTree_1_1tMHeader.html#o8">ObjectCount</a> += inc;
01170          this-&gt;HeaderUpdate = <span class="keyword">true</span>;
01171       }<span class="comment">//end UpdateObjectCounter</span>
01172 
01203       <span class="keywordtype">int</span> InsertRecursive(<a class="code" href="group__types.html#a4">stPageID</a> currNodeID, ObjectType * newObj,
01204             ObjectType * repObj, <a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a> &amp; promo1, <a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a> &amp; promo2);
01205 
01216       <span class="keywordtype">void</span> AddNewRoot(ObjectType * obj1, <a class="code" href="group__types.html#a6">stDistance</a> radius1, <a class="code" href="group__types.html#a4">stPageID</a> nodeID1,
01217                       ObjectType * obj2, <a class="code" href="group__types.html#a6">stDistance</a> radius2, <a class="code" href="group__types.html#a4">stPageID</a> nodeID2);
01218 
01235       <span class="keywordtype">void</span> SplitLeaf(<a class="code" href="classstMLeafNode.html">stMLeafNode</a> * oldNode, <a class="code" href="classstMLeafNode.html">stMLeafNode</a> * newNode,
01236             ObjectType * newObj, ObjectType * prevRep,
01237             <a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a> &amp; promo1, <a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a> &amp; promo2);
01238 
01264       <span class="keywordtype">void</span> SplitIndex(<a class="code" href="classstMIndexNode.html">stMIndexNode</a> * oldNode, <a class="code" href="classstMIndexNode.html">stMIndexNode</a> * newNode,
01265             ObjectType * newObj1, <a class="code" href="group__types.html#a6">stDistance</a> newRadius1, <a class="code" href="group__types.html#a4">stPageID</a> newNodeID1,
01266             ObjectType * newObj2, <a class="code" href="group__types.html#a6">stDistance</a> newRadius2, <a class="code" href="group__types.html#a4">stPageID</a> newNodeID2, 
01267             ObjectType * prevRep,
01268             <a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a> &amp; promo1, <a class="code" href="structstSubtreeInfo.html">stSubtreeInfo</a> &amp; promo2);
01269 
01281       <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a20">RangeQuery</a>(<a class="code" href="group__types.html#a4">stPageID</a> pageID, tResult * result,
01282             ObjectType * sample, <a class="code" href="group__types.html#a6">stDistance</a> range,
01283             <a class="code" href="group__types.html#a6">stDistance</a> distanceRepres);
01284 
01295       <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a21">NearestQuery</a>(tResult * result, ObjectType * sample,
01296                         <a class="code" href="group__types.html#a6">stDistance</a> rangeK, <a class="code" href="group__types.html#a7">stCount</a> k);
01297 
01314       <span class="keywordtype">void</span> <a class="code" href="classstMTree.html#a22">PointQuery</a>(tResult * result, ObjectType * sample);
01315 
01319       <span class="keywordtype">void</span> UpdateDistances(<a class="code" href="classstMIndexNode.html">stMIndexNode</a> *node, ObjectType * repObj, <span class="keywordtype">int</span> repObjIdx);
01320 
01329       <span class="keywordtype">void</span> GetTreeInfoRecursive(<a class="code" href="group__types.html#a4">stPageID</a> pageID, <span class="keywordtype">int</span> level,
01330             <a class="code" href="classstTreeInformation.html">stTreeInformation</a> * info);
01331 
01341       <span class="keywordtype">void</span> ObjectIntersectionsRecursive(<a class="code" href="group__types.html#a4">stPageID</a> pageID, ObjectType * obj,
01342             <span class="keywordtype">int</span> level, <a class="code" href="classstTreeInformation.html">stTreeInformation</a> * info);
01343             
01344 };<span class="comment">//end stMTree</span>
01345 
01346 <span class="comment">// Include implementation</span>
01347 <span class="preprocessor">#include "stMTree.cc"</span>
01348 
01349 <span class="preprocessor">#endif //__STMTREE_H</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Mon Mar 21 16:12:06 2005 for GBDI Arboretum by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.3.4</small><br>
Copyright &copy 2002-2003 GBDI-ICMC-USP
</address>
</body>
</html>
