<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>stFastMapper.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<h1>GBDI Arboretum<br><small>Version Release 1</small></h1>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>stFastMapper.h</h1><a href="stFastMapper_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/**********************************************************************</span>
00002 <span class="comment">* GBDI Arboretum - Copyright (c) 2002-2004 GBDI-ICMC-USP</span>
00003 <span class="comment">*</span>
00004 <span class="comment">*                           Homepage: http://gbdi.icmc.usp.br/arboretum</span>
00005 <span class="comment">**********************************************************************/</span>
00006 <span class="comment">/* ====================================================================</span>
00007 <span class="comment"> * The GBDI-ICMC-USP Software License Version 1.0</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Copyright (c) 2004 Grupo de Bases de Dados e Imagens, Instituto de</span>
00010 <span class="comment"> * Ciências Matemáticas e de Computação, University of São Paulo -</span>
00011 <span class="comment"> * Brazil (the Databases and Image Group - Intitute of Matematical and </span>
00012 <span class="comment"> * Computer Sciences).  All rights reserved.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
00015 <span class="comment"> * modification, are permitted provided that the following conditions</span>
00016 <span class="comment"> * are met:</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * 1. Redistributions of source code must retain the above copyright</span>
00019 <span class="comment"> *    notice, this list of conditions and the following disclaimer.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span>
00022 <span class="comment"> *    notice, this list of conditions and the following disclaimer in</span>
00023 <span class="comment"> *    the documentation and/or other materials provided with the</span>
00024 <span class="comment"> *    distribution.</span>
00025 <span class="comment"> *</span>
00026 <span class="comment"> * 3. The end-user documentation included with the redistribution,</span>
00027 <span class="comment"> *    if any, must include the following acknowledgment:</span>
00028 <span class="comment"> *       "This product includes software developed by Grupo de Bases</span>
00029 <span class="comment"> *        de Dados e Imagens, Instituto de Ciências Matemáticas e de</span>
00030 <span class="comment"> *        Computação, University of São Paulo - Brazil (the Databases </span>
00031 <span class="comment"> *        and Image Group - Intitute of Matematical and Computer </span>
00032 <span class="comment"> *        Sciences)"</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> *    Alternately, this acknowledgment may appear in the software itself,</span>
00035 <span class="comment"> *    if and wherever such third-party acknowledgments normally appear.</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> * 4. The names of the research group, institute, university, authors</span>
00038 <span class="comment"> *    and collaborators must not be used to endorse or promote products</span>
00039 <span class="comment"> *    derived from this software without prior written permission.</span>
00040 <span class="comment"> *</span>
00041 <span class="comment"> * 5. The names of products derived from this software may not contain</span>
00042 <span class="comment"> *    the name of research group, institute or university, without prior</span>
00043 <span class="comment"> *    written permission of the authors of this software.</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED</span>
00046 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
00047 <span class="comment"> * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
00048 <span class="comment"> * DISCLAIMED.  IN NO EVENT SHALL THE AUTHORS OF THIS SOFTWARE OR</span>
00049 <span class="comment"> * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00050 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00051 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
00052 <span class="comment"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
00053 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
00054 <span class="comment"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
00055 <span class="comment"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
00056 <span class="comment"> * SUCH DAMAGE.</span>
00057 <span class="comment"> *</span>
00058 <span class="comment"> * ====================================================================</span>
00059 <span class="comment"> *                                            http://gbdi.icmc.usp.br/</span>
00060 <span class="comment"> */</span>
00073 <span class="comment">// Copyright (c) 2002-2003 GBDI-ICMC-USP</span>
00074 <span class="preprocessor">#ifndef __STFASTMAPPER_H</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#define __STFASTMAPPER_H</span>
00076 <span class="preprocessor"></span>
00077 
00078 <span class="comment">//----------------------------------------------------------------------------</span>
00079 <span class="comment">// Simple euclidean distance</span>
00080 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00091"></a><a class="code" href="group__fastmap.html#a0">00091</a> <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; T <a class="code" href="group__fastmap.html#a0">Euclidean2</a>(<span class="keyword">const</span> T * a, <span class="keyword">const</span> T * b, <span class="keywordtype">int</span> n){
00092    <span class="keywordtype">int</span> i;
00093    T tmp;
00094    T d;
00095 
00096    d = 0;
00097    <span class="keywordflow">for</span> (i = 0; i &lt; n; i++){
00098       tmp = a[i] - b[i];
00099       d += tmp * tmp;
00100    }<span class="comment">//end for</span>
00101 
00102    <span class="keywordflow">return</span> d;
00103 }<span class="comment">//end Eucliden2</span>
00104 
00105 <span class="comment">//------------------------------------------------------------------------------</span>
00106 <span class="comment">// Class stFastMapImage</span>
00107 <span class="comment">//------------------------------------------------------------------------------</span>
00126 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> ObjectType&gt;
<a name="l00127"></a><a class="code" href="classstFastMapImage.html">00127</a> <span class="keyword">class </span><a class="code" href="classstFastMapImage.html">stFastMapImage</a>{
00128    <span class="keyword">public</span>:
<a name="l00137"></a><a class="code" href="classstFastMapImage.html#a0">00137</a>       <a class="code" href="classstFastMapImage.html#a0">stFastMapImage</a>(ObjectType * object, <span class="keywordtype">int</span> dim, <span class="keywordtype">bool</span> ownership = <span class="keyword">false</span>){
00138 
00139          <span class="comment">// Initialize</span>
00140          Object = object;
00141          Mine = ownership;
00142          Dim = dim;
00143          Coords = <span class="keyword">new</span> <span class="keywordtype">double</span>[dim];
00144       }<span class="comment">//end stFastMapImage</span>
00145 
<a name="l00150"></a><a class="code" href="classstFastMapImage.html#a1">00150</a>       <span class="keyword">virtual</span> <a class="code" href="classstFastMapImage.html#a1">~stFastMapImage</a>(){
00151 
00152          <span class="keywordflow">if</span> (Coords != NULL){
00153             <span class="keyword">delete</span>[] Coords;
00154          }<span class="comment">//end if</span>
00155 
00156          <span class="keywordflow">if</span> ((Object != NULL) &amp;&amp; (Mine)){
00157             <span class="keyword">delete</span> Object;
00158          }<span class="comment">//end if</span>
00159       }<span class="comment">//end ~stFastMapImage</span>
00160 
<a name="l00164"></a><a class="code" href="classstFastMapImage.html#a2">00164</a>       <span class="keyword">const</span> ObjectType * <a class="code" href="classstFastMapImage.html#a2">GetObject</a>(){
00165          <span class="keywordflow">return</span> Object;
00166       }<span class="comment">//end GetObject</span>
00167 
<a name="l00175"></a><a class="code" href="classstFastMapImage.html#a3">00175</a>       <span class="keywordtype">void</span> <a class="code" href="classstFastMapImage.html#a3">SetObject</a>(ObjectType * obj, <span class="keywordtype">bool</span> ownership = <span class="keyword">false</span>){
00176 
00177          <span class="keywordflow">if</span> ((Object != NULL) &amp;&amp; (Mine)){
00178             <span class="keyword">delete</span> Object;
00179          }<span class="comment">//end if</span>
00180 
00181          Object = obj;
00182          Mine = ownership;
00183       }<span class="comment">//end GetObject</span>
00184 
<a name="l00188"></a><a class="code" href="classstFastMapImage.html#a4">00188</a>       <span class="keywordtype">double</span> &amp; <a class="code" href="classstFastMapImage.html#a4">operator [] </a>(<span class="keywordtype">int</span> idx){
00189          <span class="keywordflow">return</span> Coords[idx];
00190       }<span class="comment">//end operator []</span>
00191 
<a name="l00198"></a><a class="code" href="classstFastMapImage.html#a5">00198</a>       <span class="keywordtype">void</span> <a class="code" href="classstFastMapImage.html#a6">GetCoords</a>(<span class="keywordtype">double</span> * coords){
00199          memcpy(coords, Coords, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * Dim);
00200       }<span class="comment">//end GetCoords</span>
00201 
<a name="l00206"></a><a class="code" href="classstFastMapImage.html#a6">00206</a>       <span class="keyword">const</span> <span class="keywordtype">double</span> * <a class="code" href="classstFastMapImage.html#a6">GetCoords</a>(){
00207          <span class="keywordflow">return</span> Coords;
00208       }<span class="comment">//end GetCoords</span>
00209 
<a name="l00215"></a><a class="code" href="classstFastMapImage.html#a7">00215</a>       <span class="keywordtype">void</span> <a class="code" href="classstFastMapImage.html#a7">SetCoords</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> * coords){
00216          memcpy(Coords, coords, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * Dim);
00217       }<span class="comment">//end GetCoords</span>
00218 
00224       <span class="keywordtype">void</span> <a class="code" href="classstFastMapImage.html#a8">SetCoordsTo</a>(<span class="keywordtype">double</span> value = 0);
00225 
<a name="l00229"></a><a class="code" href="classstFastMapImage.html#a9">00229</a>       <span class="keywordtype">int</span> <a class="code" href="classstFastMapImage.html#a9">GetDimension</a>(){
00230          <span class="keywordflow">return</span> Dim;
00231       }<span class="comment">//end GetDimension</span>
00232 
<a name="l00236"></a><a class="code" href="classstFastMapImage.html#a10">00236</a>       <a class="code" href="classstFastMapImage.html">stFastMapImage</a> * <a class="code" href="classstFastMapImage.html#a10">Clone</a>(){
00237          <a class="code" href="classstFastMapImage.html">stFastMapImage</a> * c;
00238 
00239          c = <span class="keyword">new</span> <a class="code" href="classstFastMapImage.html#a0">stFastMapImage</a>(object-&gt;Clone(), Dim, <span class="keyword">true</span>);
00240          c-&gt;<a class="code" href="classstFastMapImage.html#a7">SetCoords</a>(Coords);
00241          <span class="keywordflow">return</span> c;
00242       }<span class="comment">//end Clone</span>
00243    <span class="keyword">private</span>:
00247       <span class="keywordtype">int</span> Dim;
00248 
00252       <span class="keywordtype">double</span> * Coords;
00253 
00257       ObjectType * Object;
00258 
00262       <span class="keywordtype">bool</span> Mine;
00263 };<span class="comment">//end stFastMapImage</span>
00264 
00265 <span class="comment">//------------------------------------------------------------------------------</span>
00266 <span class="comment">// stFastMapper</span>
00267 <span class="comment">//------------------------------------------------------------------------------</span>
00318 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> ObjectType, <span class="keyword">class</span> EvaluatorType&gt;
<a name="l00319"></a><a class="code" href="classstFastMapper.html">00319</a> <span class="keyword">class </span><a class="code" href="classstFastMapper.html">stFastMapper</a>{
00320    <span class="keyword">public</span>:
<a name="l00331"></a><a class="code" href="classstFastMapper.html#a0">00331</a>       <a class="code" href="classstFastMapper.html#a0">stFastMapper</a>(EvaluatorType * eval, <span class="keywordtype">int</span> dim = 3, <span class="keywordtype">int</span> dLoopCount = 5){
00332          <span class="comment">// Initialize</span>
00333          Eval = eval;
00334          Dim = dim;
00335          DLoopCount = dLoopCount;
00336 
00337          <span class="comment">// Make room for pivots</span>
00338          PivotDist = <span class="keyword">new</span> <span class="keywordtype">double</span>[Dim];
00339          PivotDist2 = <span class="keyword">new</span> <span class="keywordtype">double</span>[Dim];
00340          Pivots = <span class="keyword">new</span> <a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a> * [Dim * 2];
00341          memset(Pivots, 0, <span class="keyword">sizeof</span>(stFastMapImage&lt;ObjectType&gt; *) * Dim * 2);
00342       }<span class="comment">//end stFastMapper</span>
00343 
00347       <a class="code" href="classstFastMapper.html#a1">~stFastMapper</a>();
00348 
00357       <span class="keywordtype">void</span> <a class="code" href="classstFastMapper.html#a2">Map</a>(ObjectType * obj, <span class="keywordtype">double</span> * map);
00358 
<a name="l00362"></a><a class="code" href="classstFastMapper.html#a3">00362</a>       <span class="keywordtype">int</span> <a class="code" href="classstFastMapper.html#a3">GetDimensions</a>(){
00363          <span class="keywordflow">return</span> Dim;
00364       }<span class="comment">//end GetDimensions</span>
00365       
00391       <span class="keywordtype">void</span> <a class="code" href="classstFastMapper.html#a4">ChoosePivots</a>(ObjectType ** objs, <span class="keywordtype">int</span> n,
00392             <span class="keywordtype">double</span> * maps = NULL, <span class="keywordtype">int</span> * pivotids = NULL);
00393 
<a name="l00401"></a><a class="code" href="classstFastMapper.html#a5">00401</a>       <span class="keywordtype">int</span> <a class="code" href="classstFastMapper.html#a5">GetPivotIdx</a>(<span class="keywordtype">int</span> axis, <span class="keywordtype">int</span> name){
00402          <span class="keywordflow">return</span> (axis * 2) + name;
00403       }<span class="comment">//end GetPivotIdx</span>
00404 
<a name="l00412"></a><a class="code" href="classstFastMapper.html#a6">00412</a>       <span class="keyword">const</span> ObjectType * <a class="code" href="classstFastMapper.html#a6">GetPivotObject</a>(<span class="keywordtype">int</span> idx){
00413          <span class="keywordflow">if</span> (Pivots[idx] != NULL){
00414             <span class="keywordflow">return</span> Pivots[idx]-&gt;GetObject();
00415          }<span class="keywordflow">else</span>{
00416             <span class="keywordflow">return</span> NULL;
00417          }<span class="comment">//end if</span>
00418       }<span class="comment">//end GetPivotObject</span>
00419 
<a name="l00430"></a><a class="code" href="classstFastMapper.html#a7">00430</a>       <span class="keywordtype">void</span> <a class="code" href="classstFastMapper.html#a7">GetPivotMap</a>(<span class="keywordtype">int</span> idx, <span class="keywordtype">double</span> * map){
00431          <span class="keywordflow">if</span> (Pivots[idx] != NULL){
00432             Pivots[idx]-&gt;GetCoords(map);
00433          }<span class="comment">//end if</span>
00434       }<span class="comment">//end GetPivotMap</span>
00435 
<a name="l00454"></a><a class="code" href="classstFastMapper.html#a8">00454</a>       <span class="keywordtype">void</span> <a class="code" href="classstFastMapper.html#a8">SetPivot</a>(<span class="keywordtype">int</span> idx, <span class="keyword">const</span> ObjectType * obj, <span class="keyword">const</span> <span class="keywordtype">double</span> * map){
00455 
00456          <span class="comment">// Create image if required.</span>
00457          <span class="keywordflow">if</span> (Pivots[idx] == NULL){
00458             Pivots[idx] = <span class="keyword">new</span> <a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a>(((ObjectType *)obj)-&gt;Clone(), Dim);
00459          }<span class="keywordflow">else</span>{
00460             Pivots[idx]-&gt;SetObject(((ObjectType *)obj)-&gt;Clone());
00461          }<span class="comment">//end if</span>
00462 
00463          <span class="comment">// Replace image contents</span>
00464          <span class="keywordflow">if</span> (map != NULL){
00465             Pivots[idx]-&gt;SetCoords(map);
00466          }<span class="comment">//end if</span>
00467       }<span class="comment">//end SetPivot</span>
00468 
00475       <span class="keywordtype">void</span> <a class="code" href="classstFastMapper.html#a9">UpdatePivotMaps</a>();
00476 
00488       <span class="keywordtype">double</span> <a class="code" href="classstFastMapper.html#a10">GetStress</a>(<span class="keywordtype">int</span> n, <span class="keyword">const</span> ObjectType ** objs, <span class="keyword">const</span> <span class="keywordtype">double</span> ** maps);
00489 
<a name="l00497"></a><a class="code" href="classstFastMapper.html#a11">00497</a>       <span class="keywordtype">bool</span> <a class="code" href="classstFastMapper.html#a11">IsReady</a>(){
00498          <span class="keywordflow">return</span> (Pivots[(Dim * 2) - 1] != NULL);
00499       }<span class="comment">//end IsReady</span>
00500    <span class="keyword">private</span>:
00504       <span class="keywordtype">int</span> Dim;
00505 
00509       <span class="keywordtype">int</span> DLoopCount;
00510 
00514       EvaluatorType * Eval;
00515 
00519       <a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a> ** Pivots;
00520 
00524       <span class="keywordtype">double</span> * PivotDist;
00525 
00529       <span class="keywordtype">double</span> * PivotDist2;
00530 
00538       <a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a> ** CreateTmpImageVector(ObjectType ** objs, <span class="keywordtype">int</span> n);
00539 
00546       <span class="keywordtype">void</span> DisposeImageVector(<a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a> ** vec, <span class="keywordtype">int</span> n);
00547 
00555       <span class="keywordtype">void</span> GetImageMaps(<a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a> ** imgs, <span class="keywordtype">int</span> n, <span class="keywordtype">double</span> * maps);
00556 
00567       <span class="keywordtype">void</span> FindPivots(<a class="code" href="classstFastMapImage.html">stFastMapImage&lt;ObjectType&gt;</a> ** imgs, <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> axis, <span class="keywordtype">int</span> &amp; pa, <span class="keywordtype">int</span> &amp; pb,
00568             <span class="keywordtype">double</span> &amp; dist);
00569 
00577       <span class="keywordtype">double</span> Project(<span class="keyword">const</span> ObjectType * obj, <span class="keyword">const</span> <span class="keywordtype">double</span> * map, <span class="keywordtype">int</span> axis);
00578 
00591       <span class="keywordtype">double</span> GetFMDistance2(<span class="keyword">const</span> ObjectType * o1, <span class="keyword">const</span> <span class="keywordtype">double</span> * map1,
00592             <span class="keyword">const</span> ObjectType * o2, <span class="keyword">const</span> <span class="keywordtype">double</span> * map2, <span class="keywordtype">int</span> axis){
00593 
00594          <span class="keywordflow">return</span> Eval-&gt;GetDistance2((ObjectType *) o1, (ObjectType *)o2)
00595                - <a class="code" href="group__fastmap.html#a0">Euclidean2</a>(map1, map2, axis);
00596       }<span class="comment">//end GetFMDistance2</span>
00597 };<span class="comment">//end stFastMapper</span>
00598 
00599 <span class="comment">// Include Template source</span>
00600 <span class="preprocessor">#include &lt;arboretum/stFastMapper.cc&gt;</span>
00601 
00602 <span class="preprocessor">#endif //__STFASTMAPPER_H</span>
</pre></div><hr><address style="align: right;"><small>
Generated on Mon Mar 21 16:12:06 2005 for GBDI Arboretum by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.3.4</small><br>
Copyright &copy 2002-2003 GBDI-ICMC-USP
</address>
</body>
</html>
